{% extends "base.html" %}

{% load static %}

<script type="text/javascript">

    {% block jquery %}
    function updateLikes(likes) {
        if (likes == 1) {
            $('#like-btn').addClass('liked');
            document.getElementById('likeImg').src = "/static/images/heart_active.svg";
        } else {
            $('#like-btn').removeClass('liked');
            document.getElementById('likeImg').src = "/static/images/heart.svg";
        }
        $('#likes').text(likes)
    }

    function showLoader() {
        var loader = document.getElementById('comment_loader')
        loader.style.display = 'block'
    }

    function hideLoader() {
        var loader = document.getElementById('comment_loader')
        loader.style.display = 'none'
    }

    function updateComment(user, comment) {
        var com = document.getElementById('comments-list')
        hideLoader()
        com.innerHTML = '<h5>{{user}}</h5><p>' + comment + '</p>' + com.innerHTML
        document.getElementById('comment').value = ''
    }

    $("#comment-btn").click(function (e) {
        e.preventDefault()
        showLoader()
        console.log('clicked')
        var this_ = $(this)

        var commentUrl = this_.attr('data-comment')
        var slug = this_.attr('data-comment-slug')

        $.ajax({
            url: commentUrl,
            method: "POST",
            data: {
                'slug': slug,
                'comment_text': document.getElementById('comment').value,
                'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
            },
            success: function (data) {
                if (data.success) {
                    updateComment(data.user, data.comment)
                } else {

                }
            }, error: function (error) {
            },
        })
    })

    $("#like-btn").click(function (e) {
        e.preventDefault();
        var this_ = $(this)
        var user = this_.attr('data-user')
        if (user) {
            var likeUrl = this_.attr('data-href')
            var slug = this_.attr('data-slug')
            var likes = this_.attr('data-likes')
            $.ajax({
                url: likeUrl,
                method: "POST",
                data: {
                    'slug': slug,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (data) {
                    updateLikes(data.likes)
                }, error: function (error) {

                },

            })
        } if (user == "False") {
            alert('You need to login to like this post')
        }
    })
    {% endblock %}
</script>

{% block content %}
<link rel="stylesheet" href="{% static 'blogs/css/indi_blog.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<div class="center">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'blogs:index' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'blogs:sub_topic' slug=slug %}">{{ main_blog }}</a></li>
        <li class="breadcrumb-item active">{{ blog_content.heading | title }}</li>
    </ol>
</div>
<div class="row">
    <div class="col-sm-12 col-md-12 col-lg-2"></div>
    <div class="col-sm-12 col-md-12 col-lg-8 container">
        <h2>{{ blog_content.heading }}</h2>
    </div>
    <div class="col-sm-12 col-md-12 col-lg-2"></div>
</div>


<div class="row">
    <div class="col-sm-12 col-md-12 col-lg-2 container">
        <ul class="list-group list-group-flush">
            {% for blog in all_blogs %}
            {% if blog.slug == blog_content.slug %}
            <a class="list-group-item list-group-item-action" id="selected"
                href="{% url 'blogs:blog_post' slug=slug blog=blog.slug %}">{{ blog.heading }}</a>
            {% else %}
            <a class="list-group-item list-group-item-action" id="listItem"
                href="{% url 'blogs:blog_post' slug=slug blog=blog.slug %}">{{ blog.heading }}</a>
            {% endif %}
            {% endfor %}
        </ul>
    </div>

    <div class="col-sm-12 col-md-12 col-lg-8 container" style="margin-top: 0px;">

        <!-- for short desc -->
        <div class="card-panel">
            <p>
                ng essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktoypesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktoypesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktoypesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown
            </p>
        </div>

        <p style="margin-top: 50px;" class="container">
            {{ blog_content.content | safe | escape }}
        </p>
        <div style="margin-top: 150px;">
            <iframe src="{{ blog_content.youtube_link }}" frameborder="0" allowfullscreen id="video"></iframe>
        </div>
    </div>

    <div class="col-sm-12 col-md-12 col-lg-2">
        <!-- <ul class="list-group list-group-flush">
            <a class="list-group-item list-group-item-action" id="selected" href="">Some alksjcn</a>
        </ul> -->
    </div>
</div>

<div class="row" style="margin-top: 150px;">
    <div class="col-sm-12 col-md-6 col-lg-8 center-div">
        <hr>
        <div class="row valign-wrapper">
            <div class="col-sm-2">
                <img src="https://picsum.photos/200" alt="" class="circle responsive-img">
            </div>
            <div class="col-sm-10">
                <div>
                    <a href="#" class="font-weight-bold">
                        Name of the author
                    </a>
                </div>
                <div>
                    <span class="black-text">
                        {{ author.description }}
                    </span>
                </div>
            </div>
        </div>
        <hr>
    </div>
</div>

<!-- <div class="row">
    <div class="col-sm-12 col-md-6 col-lg-8 container center">
       
    </div>
</div> -->


<div class="row" id="commentsContainer" style="margin-top: 150px;">
    <div class="col-sm-12 col-md-6 col-lg-8 container">
        <div class="row no-gutters">
            <div class="col-6">
                <h4>Comments</h4>
            </div>
            <div class="col-6">
                <div class="row right vertical-center">
                    {% csrf_token %}
                    <i onclick="" class="icon-btn" id="like-btn"
                        data-user="{{ request.user.is_authenticated }}" data-href='{{ blog_content.get_like_url }}'
                        data-slug={{blog_content.slug}} data-likes={{blog_content.no_of_likes}}>
                        <img id="likeImg" src="/static/images/heart.svg" style="width: 30px; height: 30px;">
                    </i>
                    <p id="likes">{{ blog_content.no_of_likes }}</p>
                </div>
            </div>
        </div>

        {% if request.user.is_authenticated %}
        <div class="input-field">
            {% csrf_token %}
            <input type="text" class="validate" id="comment" placeholder="Enter your comment">
            <input type="button" value="Submit" id="comment-btn" data-comment="{{ blog_content.get_comment_url }}"
                data-comment-slug={{blog_content.slug}} class="btn">
        </div>
        {% else %}
        <div>
            <p>Login to comment</p>
        </div>
        {% endif %}
        <div id="comments-list" style="margin-top: 50px;">
            <div class="spinner-border text-primary center" role="status" id='comment_loader' style="display: none;">
                <span class="sr-only">Loading...</span>
            </div>
            {% for comment in comments %}
            <div class="row">
                <div class="col-1">
                    <img src="https://picsum.photos/200" class="circle responsive-img">
                </div>
                <div class="col-11">
                    <h5>{{ comment.user.first_name }} {{comment.user.last_name}}</h5>                
                    <p>{{ comment.comment_text }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<script>
    if (window.history.replaceState) {
        window.history.replaceState(null, null, window.location.href);
    }
</script>



{% endblock content %}